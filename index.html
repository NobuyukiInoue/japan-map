
<!DOCTYPE html>
<html>
<head>
    <title>sample japan-map</title>
    <meta charset="UTF-8">
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/jquery.japan-map.min.js"></script>
    <script type="text/javascript" src="js/jquery.tablesorter.min.js"></script>
    <script type="text/javascript" src="js/jquery.metadata.min.js"></script>
    <script type="text/javascript" src="js/csv.js"></script>
    <link rel="stylesheet" href="css/style.css" />
</head>
<body>

<table id="main">
  <tr>
    <td>
      <div id="map"></div>
    </td>
    <td>
      <div id="select_item"></div>
    </td>
  </tr>
</table>

<div hidden id="csv_result"></div>
<div id="csv_table"></div>

<script>
var timer;

$(document).ready(function() {
    var e1 = document.getElementById("csv_result");
    var e2 = document.getElementById("csv_table");

//  getCSV("data/sample.csv", e1, e2);
    getCSV("data/todofuken_utf8.csv", e1, e2);

    timer = setTimeout(set_tableSort, 2000);
});

function set_tableSort() {
    var e1 = document.getElementById("csv_result");
    var e2 = document.getElementById("csv_table");

    $("#myTable").tablesorter();
    clearTimeout(timer);
}

// tableタグを出力する
function create_detailTable(titleData, targetData, arg_id, arg_class, arg_style) {
    var table = document.createElement('table');
    table.setAttribute("id", arg_id);
    table.setAttribute("class", arg_class);
    table.setAttribute("style", arg_style);
    table.setAttribute("border", "1");

    var tbody = document.createElement('tbody');

    for (var i = 0; i < targetData.length; i++) {
        var tr = document.createElement('tr');

        // field title
        var td = document.createElement('td');
        td.innerText = titleData[i];
        tr.appendChild(td);

        // field data
        var td = document.createElement('td');
        
        if (i == 1) {
            td.innerText = targetData[i].substring(2);
        } else if (6 <= i && i <= 7 ){
            td.innerText = Number(targetData[i]).toLocaleString();
        } else {
            td.innerText = targetData[i];
        }
        td.setAttribute("align", "center");
        tr.appendChild(td);

        tbody.appendChild(tr);
     }

    table.appendChild(tbody);
    return table;
}

$(function() {
    //地域を設定
    //{"code":[地域のコード], "name": [地域の名前], "color":[地域につける色], "hoverColor":[地域をマウスでホバーしたときの色], "prefectures":[地域に含まれる都道府県のコード]}
    var areas = [
        {"code": 1 , "name":"北海道地方", "color":"#ca93ea", "hoverColor":"#e0b1fb", "prefectures":[1]},
        {"code": 2 , "name":"東北地方",   "color":"#a7a5ea", "hoverColor":"#d6d4fd", "prefectures":[2,3,4,5,6,7]},
        {"code": 3 , "name":"関東地方",   "color":"#84b0f6", "hoverColor":"#c1d8fd", "prefectures":[8,9,10,11,12,13,14]},
        {"code": 4 , "name":"北陸・甲信越地方",   "color":"#52d49c", "hoverColor":"#93ecc5", "prefectures":[15,16,17,18,19,20]},
        {"code": 4 , "name":"東海地方",   "color":"#77e18e", "hoverColor":"#aff9bf", "prefectures":[21,22,23,24]},
        {"code": 6 , "name":"近畿地方",   "color":"#f2db7b", "hoverColor":"#f6e8ac", "prefectures":[25,26,27,28,29,30]},
        {"code": 7 , "name":"中国地方",   "color":"#f9ca6c", "hoverColor":"#ffe5b0", "prefectures":[31,32,33,34,35]},
        {"code": 8 , "name":"四国地方",   "color":"#fbad8b", "hoverColor":"#ffd7c5", "prefectures":[36,37,38,39]},
        {"code": 9 , "name":"九州地方",   "color":"#f7a6a6", "hoverColor":"#ffcece", "prefectures":[40,41,42,43,44,45,46]},
        {"code":10 , "name":"沖縄地方",   "color":"#ea89c4", "hoverColor":"#fdcae9", "prefectures":[47]}
    ];

    $("#map").japanMap(
        {
            areas  : areas,             //上で設定したエリアの情報
            selection : "prefecture",   //選ぶことができる範囲(県→prefecture、エリア→area)
            borderLineWidth: 0.25,      //線の幅
            drawsBoxLine : false,       //canvasを線で囲む場合はtrue
            movesIslands : true,        //南西諸島を左上に移動させるときはtrue、移動させないときはfalse
            showsAreaName : true,       //エリア名を表示しない場合はfalse
            width: 800,                 //canvasのwidth。別途heightも指定可。
            backgroundColor: "#ffffff", //canvasの背景色
            font : "MS Mincho",         //地図に表示する文字のフォント
            fontSize : 12,              //地図に表示する文字のサイズ
            fontColor : "areaColor",    //地図に表示する文字の色。"areaColor"でエリアの色に合わせる
            fontShadowColor : "black",  //地図に表示する文字の影の色

            onSelect:function(data){ //選択範囲をクリックしたときに実行
                // location.href = areas[data.area.name]; //data.area.nameは選択したエリアの名前
                console.log(data);
                //alert(data.area.name + " : " + data.name);

                num = get_record(document.getElementById("csv_result").val, data.name);

                targetData = document.getElementById("csv_result").val[num];
            //  alert(targetData[1]);
            
                /*
                var workStr = "番号:       " + targetData[1].substring(0, 2) + "\n";
                workStr    += "都道府県名: " + targetData[1].substring(2) + "\n";
                workStr    += "都道府県庁所在地:" + targetData[3] + "\n";
                workStr    += "人口:       " + Number(targetData[6]).toLocaleString() + " 人\n";
                workStr    += "面積:       " + Number(targetData[7]).toLocaleString() + " (km2)\n";
                workStr    += "人口密度:   " + Number(targetData[8]).toLocaleString() + " (人/km2)\n";

                alert(workStr);
                */

                var e1 = document.getElementById("select_item");
                var e2 = document.getElementById("detail");

                if (e2 != null)
                   e1.removeChild(e2);

                var insertHTML = create_detailTable(document.getElementById("csv_result").val[0], targetData, "detail", "tablesorter", "line-height:1.4em; font-size:95%;");
                e1.appendChild(insertHTML);
            },
        }
    );
});
</script>

</body>
</html>
